<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.64.1" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v2.3/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v2.3/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v2.3/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v2.3/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v2.3/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v2.3/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v2.3/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v2.3/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v2.3/favicons/android-192x192.png" sizes="192x192">

<title>Etcd | </title><meta property="og:title" content="Etcd" />
<meta property="og:description" content="StorageOS requires an etcd cluster in order to function. For more information on why etcd is required please see our etcd concepts page.
We do not support using the Kubernetes etcd for StorageOS installations.
We provide two methods for installing etcd. For those looking for a quick route to evaluating StorageOS, our first method installs etcd into your Kubernetes cluster using the CoreOS operator. Due to limitations in the CoreOS operator, this installation is not backed by any persistent storage, and therefore is unsuitable for production installations." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.storageos.com/v2.3/docs/prerequisites/etcd/" />

<meta itemprop="name" content="Etcd">
<meta itemprop="description" content="StorageOS requires an etcd cluster in order to function. For more information on why etcd is required please see our etcd concepts page.
We do not support using the Kubernetes etcd for StorageOS installations.
We provide two methods for installing etcd. For those looking for a quick route to evaluating StorageOS, our first method installs etcd into your Kubernetes cluster using the CoreOS operator. Due to limitations in the CoreOS operator, this installation is not backed by any persistent storage, and therefore is unsuitable for production installations.">

<meta itemprop="wordCount" content="2041">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Etcd"/>
<meta name="twitter:description" content="StorageOS requires an etcd cluster in order to function. For more information on why etcd is required please see our etcd concepts page.
We do not support using the Kubernetes etcd for StorageOS installations.
We provide two methods for installing etcd. For those looking for a quick route to evaluating StorageOS, our first method installs etcd into your Kubernetes cluster using the CoreOS operator. Due to limitations in the CoreOS operator, this installation is not backed by any persistent storage, and therefore is unsuitable for production installations."/>



<link rel="stylesheet"  href="/css/font-awesome.css?ver=5.4.1" type="text/css" media="all">



<link rel="preload" href="/v2.3/scss/main.min.f438d2b9796945cd1ecf249ee847e52b86c90b71a65473dd7df133307855c9d3.css" as="style">
<link href="/v2.3/scss/main.min.f438d2b9796945cd1ecf249ee847e52b86c90b71a65473dd7df133307855c9d3.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>




<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>


<script
  src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.js"
  integrity=""
  crossorigin="anonymous"></script>
<link href="/css/storageos.css" rel="stylesheet">
<script> (function(h,o,t,j,a,r){ h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)}; h._hjSettings={hjid:1025326,hjsv:6}; a=o.getElementsByTagName('head')[0]; r=o.createElement('script');r.async=1; r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv; a.appendChild(r); })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv='); </script>
<script src="/js/enable-link-tab.js"></script>


    <title>Etcd | </title>
  </head>
  <body class="td-page">
    <header>
      
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">

    <div class="col-2 col-sm-2">
      <div class="navbar-header">
        <div class="logo-tag">

          <a class="navbar-brand" href="https://storageos.com">
  		<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="476.964" height="141.732" viewBox="0 0 476.964 141.732" enable-background="new 0 0 476.964 141.732"><g><g><path fill="#fff" d="M34.74 89.882H3.477v-9.34h31.264c1.538.0 2.704-.355 3.476-1.062.744-.693 1.118-1.655 1.118-2.854.0-1.318-.363-2.293-1.078-2.896-.778-.661-1.959-.996-3.515-.996H16.346c-2.017.0-3.873-.302-5.538-.905-1.681-.627-3.113-1.499-4.277-2.604-1.164-1.099-2.073-2.429-2.708-3.96-.63-1.521-.954-3.196-.954-4.967.0-1.742.293-3.379.884-4.863.592-1.499 1.489-2.828 2.67-3.938 1.181-1.097 2.635-1.957 4.316-2.572 1.657-.604 3.578-.917 5.707-.917h30.002v9.342H16.446c-1.267.0-2.232.312-2.885.928-.63.615-.943 1.487-.943 2.673.0 1.187.3 2.025.961 2.64.656.604 1.602.917 2.805.917h18.321c4.36.0 7.757 1.054 10.085 3.145 2.375 2.102 3.579 5.291 3.579 9.462.0 1.812-.284 3.5-.841 5.021-.562 1.567-1.42 2.941-2.561 4.105-1.169 1.163-2.618 2.081-4.328 2.695C38.975 89.556 36.982 89.882 34.74 89.882z"/></g><g><path fill="#fff" d="M79.764 89.882h-9.486V57.344H55.081v-9.339h39.878v9.339H79.762v32.537L79.764 89.882z"/></g><g><path fill="#fff" d="M129.784 89.882h-9.733c-2.96.0-5.731-.547-8.248-1.653-2.527-1.099-4.742-2.606-6.57-4.51-1.853-1.891-3.306-4.172-4.329-6.755-1.026-2.604-1.544-5.436-1.544-8.422.0-3.028.521-5.849 1.544-8.376 1.033-2.54 2.512-4.73 4.367-6.521 1.864-1.789 4.072-3.198 6.578-4.161 2.509-.984 5.264-1.478 8.201-1.478h9.733c3.043.0 5.878.503 8.422 1.499 2.545.996 4.77 2.415 6.616 4.229 1.846 1.823 3.288 4.015 4.294 6.521 1.01 2.482 1.521 5.278 1.521 8.286.0 3.021-.516 5.853-1.538 8.422-1.039 2.597-2.498 4.877-4.34 6.768-1.84 1.891-4.055 3.411-6.587 4.508C135.634 89.332 132.812 89.882 129.784 89.882zM120.052 57.344c-1.613.0-3.129.28-4.515.854-1.363.57-2.557 1.364-3.521 2.348-.99 1.008-1.772 2.215-2.334 3.624-.563 1.409-.848 2.986-.848 4.688.0 1.687.285 3.274.86 4.729.572 1.442 1.345 2.686 2.323 3.682.988 1.018 2.18 1.835 3.539 2.404 1.356.58 2.873.871 4.497.871h9.733c1.675.0 3.221-.291 4.583-.871 1.385-.569 2.597-1.388 3.596-2.404.982-.996 1.777-2.237 2.35-3.691.568-1.442.853-3.031.853-4.719.0-1.669-.284-3.244-.853-4.677-.561-1.409-1.351-2.63-2.344-3.624-.989-.995-2.198-1.788-3.596-2.372-1.386-.56-2.924-.84-4.589-.84L120.052 57.344z"/></g><path fill="#fff" d="M195.707 77.802c1.812-.727 3.38-1.724 4.652-3.009 1.375-1.366 2.432-2.717 3.15-4.642.643-1.711.994-3.611 1.057-5.692.006-.225.012-.6.012-.835v-.11c0-2.35-.356-4.483-1.068-6.389-.719-1.923-1.774-3.59-3.149-4.965-1.362-1.365-3.044-2.428-5.016-3.154-1.937-.716-4.139-1.085-6.786-1.007H159.05h-.483v41.882h9.706V78.975h16.071l10.03 10.903h13.561L195.707 77.802zM193.617 68.821c-1.039 1.085-2.661 1.645-4.827 1.645h-20.513V57.26h20.53c2.077.0 3.69.517 4.781 1.521 1.079 1.008 1.624 2.64 1.624 4.842C195.213 65.85 194.669 67.702 193.617 68.821z"/><path fill="#fff" d="M243.355 50.3c-.5-.839-1.086-1.499-1.723-1.968-1.441-1.105-3.906-1.12-5.438-.034-.693.516-1.277 1.188-1.75 1.992l-24.148 39.592h10.889l5.967-9.933h23.068l6.008 9.933h11.322L243.355 50.3zM230.384 72.812l8.275-13.757 8.311 13.757H230.384z"/><g><path fill="#fff" d="M314.21 89.882h-25.385c-2.959.0-5.728-.547-8.23-1.653-2.533-1.099-4.738-2.616-6.557-4.497-1.847-1.901-3.3-4.171-4.33-6.768-1.031-2.596-1.549-5.424-1.549-8.422.0-3.041.526-5.849 1.561-8.376 1.023-2.525 2.49-4.73 4.354-6.521 1.861-1.789 4.076-3.198 6.594-4.161 2.506-.984 5.265-1.478 8.185-1.478h22.94v9.342h-22.94c-1.613.0-3.123.291-4.511.851-1.34.56-2.524 1.354-3.53 2.359-.974.993-1.754 2.2-2.317 3.609-.558 1.398-.841 2.979-.841 4.688.0 1.687.283 3.274.847 4.729.573 1.442 1.352 2.686 2.321 3.682 1 1.018 2.19 1.835 3.533 2.416 1.353.567 2.862.872 4.498.872h15.883v-7.817h-18.063v-8.232h27.543v25.377H314.21V89.882z"/></g><g><path fill="#fff" d="M363.412 57.344h-38.285v-9.339h38.285V57.344z"/></g><g><path fill="#fff" d="M363.472 89.882h-38.346V64.504h36.75v8.231h-27.277v7.807h28.875v9.34H363.472z"/></g><g><path fill="#61c202" d="M402.357 89.882h-9.75c-2.961.0-5.725-.547-8.234-1.653-2.514-1.086-4.725-2.606-6.572-4.51-1.857-1.9-3.326-4.183-4.328-6.767-1.02-2.604-1.553-5.436-1.553-8.41.0-3.021.521-5.838 1.553-8.376 1.035-2.54 2.5-4.73 4.355-6.521 1.871-1.789 4.084-3.198 6.584-4.161 2.512-.984 5.271-1.478 8.195-1.478h9.75c3.033.0 5.859.503 8.416 1.499 2.568 1.009 4.799 2.438 6.611 4.238 1.84 1.801 3.285 3.994 4.291 6.497 1.012 2.517 1.523 5.304 1.523 8.3.012 3.009-.516 5.838-1.545 8.422-1.023 2.583-2.48 4.864-4.336 6.768-1.848 1.899-4.064 3.422-6.596 4.508C408.193 89.332 405.38 89.882 402.357 89.882zM392.607 57.344c-1.619.0-3.135.291-4.498.854-1.361.57-2.549 1.364-3.531 2.348-.984.996-1.768 2.215-2.314 3.613-.568 1.397-.857 2.986-.857 4.698.0 1.696.289 3.286.852 4.719.566 1.442 1.35 2.685 2.328 3.691.984 1.018 2.17 1.835 3.535 2.404 1.354.58 2.857.871 4.48.871h9.762c1.652.0 3.197-.291 4.572-.871 1.375-.569 2.596-1.388 3.602-2.404.971-.996 1.766-2.229 2.354-3.691.553-1.453.842-3.042.842-4.719.0-1.656-.289-3.234-.852-4.679-.557-1.422-1.352-2.628-2.34-3.622-1.01-.995-2.209-1.802-3.59-2.358-1.379-.562-2.936-.854-4.588-.854H392.607z"/></g><g><path fill="#61c202" d="M461.541 89.882h-31.258v-9.329h31.258c1.537.0 2.707-.355 3.475-1.071.756-.704 1.125-1.646 1.119-2.854.006-1.342-.346-2.279-1.074-2.906-.775-.649-1.961-.984-3.52-.984H443.15c-2.033.0-3.896-.302-5.539-.905-1.684-.627-3.129-1.499-4.285-2.604-1.158-1.118-2.078-2.438-2.713-3.96-.621-1.53-.934-3.196-.934-4.967.0-1.73.293-3.364.875-4.863.607-1.521 1.51-2.854 2.682-3.949 1.186-1.084 2.635-1.944 4.303-2.549 1.682-.616 3.602-.931 5.715-.931h29.984v9.341h-29.984c-1.27.0-2.25.312-2.885.928-.615.604-.943 1.51-.943 2.673.0 1.188.312 2.025.965 2.641.648.604 1.602.917 2.805.917h18.311c4.377.0 7.771 1.053 10.105 3.144 2.371 2.103 3.559 5.292 3.559 9.462.0 1.789-.271 3.468-.826 5.01-.592 1.601-1.459 2.987-2.588 4.116-1.137 1.163-2.594 2.069-4.312 2.696C465.765 89.567 463.775 89.882 461.541 89.882z"/></g></g></svg><span class="text-uppercase font-weight-bold"></span>
  	</a>

        </div>
      </div>
    </div>

    <div class="col-8 col-sm-8">
    	<div class="navbar-collapse collapse" id="bs-example-navbar-collapse-1">
    		<ul class="navbar-nav nav">
                <li>
    <a class="nav-link" href="#">
        Product <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="https://storageos.com/product">Overview</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/features">Features</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/why-storageos">Why StorageOS</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/how-it-works">How it works</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/use-cases">Use cases</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/support">Support</a></li>

    </ul>
</li>

<li class="nav-item dropdown">
    <a class="nav-link" href="#">
        Solutions <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="https://storageos.com/developers">Developers</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/infrastructure-managers">Infrastructure Managers</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/cloud">Cloud</a></li>
    </ul>
</li>

<li class="nav-item">
    <a class="nav-link" href="#">
        Docs
    </a>
</li>

<li class="nav-item dropdown">
    <a class="nav-link" href="#">
        Company <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="https://storageos.com/company">About us</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/leadership">Leadership</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/careers">Careers</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/news">News</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/events">Events</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/customers">Customers</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/partners">Partners</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/contact">Contact</a></li>
    </ul>
</li>

<li class="nav-item dropdown">
    <a class="nav-link" href="#">
          Learn <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="https://storageos.com/blog">Blog</a></li>
        <li><a class="dropdown-item" href="https://play.storageos.com/main">Play with StorageOS</a></li>
        <li><a class="dropdown-item" href="https://storageos.com/resources/">Resources</a></li>
        <li><a class="dropdown-item" href="https://resources.storageos.com/demo-request">Get a demo</a></li>
    </ul>
</li>


    			
    			<li class="nav-item dropdown d-none d-lg-block">
    				<a class="nav-link" href="#">
		Releases <span class="caret"></span>
</a>
<ul class="dropdown-menu">
	
	<li><a class="dropdown-item" href="/v1.x">v1.x</a></li>
	
	<li><a class="dropdown-item" href="/v2.0">v2.0</a></li>
	
	<li><a class="dropdown-item" href="/v2.1">v2.1</a></li>
	
	<li><a class="dropdown-item" href="/v2.2">v2.2</a></li>
	
	<li><a class="dropdown-item" href="/v2.3">v2.3</a></li>
	
	<li><a class="dropdown-item" href="/">v2.4</a></li>
	
</ul>

    			</li>
    			
    			
    		</ul>
  	</div>
  </div>
  	<div class="col-2 col-sm-2 nav-right-items">


<input
  type="search"
  class="form-control td-search-input"
  placeholder="Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/v2.3/offline-search-index.d69b670b2444da9e008038e1e9a91a8e50a47b5bab2464746ca970599a026113b9e800fc83d58892c231dcbbcef652913fb272bf54ac1b1a541cf6e8ae59fbc6.json"
  data-offline-search-base-href="/"
>

</div>
  </div>

  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>

</nav>

    </header>
    <div class="body-search">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#td-section-nav">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    


<input
  type="search"
  class="form-control td-search-input"
  placeholder="Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/v2.3/offline-search-index.d69b670b2444da9e008038e1e9a91a8e50a47b5bab2464746ca970599a026113b9e800fc83d58892c231dcbbcef652913fb272bf54ac1b1a541cf6e8ae59fbc6.json"
  data-offline-search-base-href="/"
>


  </div>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation V2</a>
  </li>
  <ul>
    <li class="collapse show" id="v23docs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/introduction/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Introduction</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsintroduction">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsintroductionoverview" href="/v2.3/docs/introduction/overview/">StorageOS V2 Overview</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsintroductionquickstart" href="/v2.3/docs/introduction/quickstart/">Quickstart</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsintroductionplatforms" href="/v2.3/docs/introduction/platforms/">Supported Platforms</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/concepts/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Concepts</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsconcepts">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptsarchitecture" href="/v2.3/docs/concepts/architecture/">Architecture</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptsclusters" href="/v2.3/docs/concepts/clusters/">Clusters</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptscompression" href="/v2.3/docs/concepts/compression/">Compression</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptsetcd" href="/v2.3/docs/concepts/etcd/">Etcd</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptsnamespaces" href="/v2.3/docs/concepts/namespaces/">Namespaces</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptsnodes" href="/v2.3/docs/concepts/nodes/">Nodes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptspolicies" href="/v2.3/docs/concepts/policies/">Policies</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptsrwx" href="/v2.3/docs/concepts/rwx/">ReadWriteMany</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptsreplication" href="/v2.3/docs/concepts/replication/">Replication</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsconceptsvolumes" href="/v2.3/docs/concepts/volumes/">Volumes</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/prerequisites/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Prerequisites</a>
  </li>
  <ul>
    <li class="collapse show" id="v23docsprerequisites">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsprerequisitessystemconfiguration" href="/v2.3/docs/prerequisites/systemconfiguration/">System Configuration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsprerequisitesipv6" href="/v2.3/docs/prerequisites/ipv6/">Availability of IPv6</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsprerequisitesfirewalls" href="/v2.3/docs/prerequisites/firewalls/">Ports and Firewall settings</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsprerequisitesmountpropagation" href="/v2.3/docs/prerequisites/mountpropagation/">Mount Propagation</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsprerequisitespidlimits" href="/v2.3/docs/prerequisites/pidlimits/">PID Limits</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsprerequisitesmax-aio" href="/v2.3/docs/prerequisites/max-aio/">Max AIO</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-v23docsprerequisitesetcd" href="/v2.3/docs/prerequisites/etcd/">Etcd</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/install/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Install</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsinstall">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsinstallkubernetes" href="/v2.3/docs/install/kubernetes/">Kubernetes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsinstallopenshift" href="/v2.3/docs/install/openshift/">OpenShift</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsinstallrancher" href="/v2.3/docs/install/rancher/">Rancher</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/platforms/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Platforms</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsplatforms">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsplatformsaws-eks" href="/v2.3/docs/platforms/aws-eks/">AWS EKS</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsplatformsazure-aks" href="/v2.3/docs/platforms/azure-aks/">Azure AKS</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsplatformsdockeree" href="/v2.3/docs/platforms/dockeree/">DockerEE</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsplatformsopenshift" href="/v2.3/docs/platforms/openshift/">OpenShift</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsplatformsrancher" href="/v2.3/docs/platforms/rancher/">Rancher</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsbest-practices" href="/v2.3/docs/best-practices/">Best Practices</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/operations/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Operations</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsoperations">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationscluster-id" href="/v2.3/docs/operations/cluster-id/">ClusterID</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/operations/etcd/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Etcd</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsoperationsetcd">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsetcdmigrate-etcd-cluster" href="/v2.3/docs/operations/etcd/migrate-etcd-cluster/">Etcd node migration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsetcdstorageos-secret-info" href="/v2.3/docs/operations/etcd/storageos-secret-info/">mTLS</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsfirstpvc" href="/v2.3/docs/operations/firstpvc/">First PVC</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationshealth" href="/v2.3/docs/operations/health/">Health</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsmanaging-host-storage" href="/v2.3/docs/operations/managing-host-storage/">Host Storage</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationslicensing" href="/v2.3/docs/operations/licensing/">Licensing</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsnamespaces" href="/v2.3/docs/operations/namespaces/">Namespaces</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationspolicies" href="/v2.3/docs/operations/policies/">Policies</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsrwx" href="/v2.3/docs/operations/rwx/">ReadWriteMany</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsstorageclasses" href="/v2.3/docs/operations/storageclasses/">StorageClasses</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationstroubleshooting" href="/v2.3/docs/operations/troubleshooting/">Troubleshooting</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsuninstall" href="/v2.3/docs/operations/uninstall/">Uninstall StorageOS</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsupgrade" href="/v2.3/docs/operations/upgrade/">Upgrade StorageOS</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsusers" href="/v2.3/docs/operations/users/">User Management</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsoperationsresize" href="/v2.3/docs/operations/resize/">Volume Resize</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/usecases/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Use Cases</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsusecases">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasescassandra" href="/v2.3/docs/usecases/cassandra/">Cassandra</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecaseselasticsearch" href="/v2.3/docs/usecases/elasticsearch/">Elasticsearch</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasesinfluxdb" href="/v2.3/docs/usecases/influxdb/">InfluxDB</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasesjenkins" href="/v2.3/docs/usecases/jenkins/">Jenkins</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecaseskafka" href="/v2.3/docs/usecases/kafka/">Kafka</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecaseskubevirt" href="/v2.3/docs/usecases/kubevirt/">Kubevirt</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasesmssql" href="/v2.3/docs/usecases/mssql/">MS SQL</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasesmysql" href="/v2.3/docs/usecases/mysql/">MySQL</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasesnginx" href="/v2.3/docs/usecases/nginx/">Nginx</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasespostgres" href="/v2.3/docs/usecases/postgres/">PostgreSQL</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasesprometheus" href="/v2.3/docs/usecases/prometheus/">Prometheus</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasesredis" href="/v2.3/docs/usecases/redis/">Redis</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasessidecar-backups" href="/v2.3/docs/usecases/sidecar-backups/">Sidecar Backups</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecasesvelero-backups" href="/v2.3/docs/usecases/velero-backups/">Velero Backups</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsusecaseszookeeper" href="/v2.3/docs/usecases/zookeeper/">Zookeeper</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/reference/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Reference</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsreference">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/reference/bundles/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Bundles</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsreferencebundles">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencebundlesdiagnostic-bundle" href="/v2.3/docs/reference/bundles/diagnostic-bundle/">Diagnostic bundle</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencebundlessupport_bundle" href="/v2.3/docs/reference/bundles/support_bundle/">Support bundle</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferenceapi" href="/v2.3/docs/reference/api/">API Reference</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/reference/cli/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">CLI</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsreferencecli">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecliapply" href="/v2.3/docs/reference/cli/apply/">Apply</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecliattach" href="/v2.3/docs/reference/cli/attach/">Attach</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferenceclicreate" href="/v2.3/docs/reference/cli/create/">Create</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferenceclidelete" href="/v2.3/docs/reference/cli/delete/">Delete</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferenceclidescribe" href="/v2.3/docs/reference/cli/describe/">Describe</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferenceclidetach" href="/v2.3/docs/reference/cli/detach/">Detach Volume</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecliget" href="/v2.3/docs/reference/cli/get/">Get</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferenceclihelp" href="/v2.3/docs/reference/cli/help/">Help</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecliupdate" href="/v2.3/docs/reference/cli/update/">Update volume</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecliversion" href="/v2.3/docs/reference/cli/version/">Version</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v2.3/docs/reference/cluster-operator/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Cluster Operator</a>
  </li>
  <ul>
    <li class="collapse " id="v23docsreferencecluster-operator">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecluster-operatorinstall" href="/v2.3/docs/reference/cluster-operator/install/">Install</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecluster-operatorconfiguration" href="/v2.3/docs/reference/cluster-operator/configuration/">Configuration</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecluster-operatorexamples" href="/v2.3/docs/reference/cluster-operator/examples/">Examples</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecluster-operatorupgrade" href="/v2.3/docs/reference/cluster-operator/upgrade/">Operator upgrade</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencecontributing" href="/v2.3/docs/reference/contributing/">Contributing to the docs</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencegui" href="/v2.3/docs/reference/gui/">GUI</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferenceinit-container" href="/v2.3/docs/reference/init-container/">Init container</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencelabels" href="/v2.3/docs/reference/labels/">Labels</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencelicence" href="/v2.3/docs/reference/licence/">Licence</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferenceopen_source_attribution" href="/v2.3/docs/reference/open_source_attribution/">Open Source Attribution</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencerelease_notes" href="/v2.3/docs/reference/release_notes/">Release notes</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferenceresource_requests_and_limits" href="/v2.3/docs/reference/resource_requests_and_limits/">Resource Requests and Limits</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencetelemetry" href="/v2.3/docs/reference/telemetry/">StorageOS Telemetry</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencefilesystems" href="/v2.3/docs/reference/filesystems/">Supported File systems</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsreferencetolerations" href="/v2.3/docs/reference/tolerations/">Tolerations</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docssupport" href="/v2.3/docs/support/">Support</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v23docsself-eval" href="/v2.3/docs/self-eval/">Self Evaluation Guide</a>
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            













          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="https://docs.storageos.com/v2.3/docs/">Documentation V2</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://docs.storageos.com/v2.3/docs/prerequisites/">Prerequisites</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://docs.storageos.com/v2.3/docs/prerequisites/etcd/">Etcd</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>Etcd</h1>
	
	<p>StorageOS requires an etcd cluster in order to function. For more information
on why etcd is required please see our <a href="https://docs.storageos.com/v2.3/docs/concepts/etcd/">etcd concepts</a> page.</p>
<p>We do not support using the Kubernetes etcd for StorageOS installations.</p>
<p>We provide two methods for installing etcd. For those looking for a quick
route to evaluating StorageOS, our first method installs etcd into your
Kubernetes cluster using the CoreOS operator. Due to limitations in the CoreOS
operator, this installation is not backed by any persistent storage, and
therefore is unsuitable for production installations.</p>
<p>For production installations, there is currently no satisfactory way of
installing a production-grade etcd cluster inside Kubernetes (although the
landscape is changing rapidly, watch this space), and our production guidance
remains to install etcd on separate machines outside of your Kubernetes
cluster. This method is the best way to ensure a stable StorageOS cluster.
Please see our etcd operations page for additional information on deployment
<a href="https://docs.storageos.com/v2.3/docs/operations/etcd/">best practices</a> and concerns.</p>
<ol>
<li>Ephemeral pods within Kubernetes (<em>Testing</em>)</li>
<li>External Virtual Machines (<em>Production</em>)</li>
</ol>
<p>Click the tabs below to select the installation method of your choice.</p>
<nav>
	<div class="nav nav-tabs" id="nav-tab" role="tablist">

		
		
		
		

            
            

            
            

            

            

		<a class="nav-item nav-link active" id="nav-9" data-toggle="tab" href="#testing" role="tab"
		   aria-controls="nav-home" aria-selected="true">Testing</a>

            
		

            
            

            
            

            

            

		<a class="nav-item nav-link" id="nav-9" data-toggle="tab" href="#production" role="tab"
		   aria-controls="nav-home" aria-selected="false">Production</a>

            
		

	</div>
</nav>

<div class="tab-content" id="9">
    <br></br>








<div class="tab-pane fade show active" id="testing" role="tabpanel" aria-labelledby="nav-testing">
    <h2 id="testing---installing-etcd-into-your-kubernetes-cluster">Testing - Installing Etcd Into Your Kubernetes Cluster</h2>
<p><strong>This fast and convenient method is useful for quickly creating an etcd
cluster in order to evaluate StorageOS. Do not use it for production
installations.</strong></p>
<p>This method uses the <a href="https://github.com/coreos/etcd-operator">CoreOS
etcd-operator</a> to install a 3 node
etcd cluster within your Kubernetes cluster, in the <code>storageos-etcd</code>
namespace. We then install a Kubernetes service in that same namespace.</p>
<p>The official etcd-operator repository also has a backup deployment operator
that can help backup etcd data. <strong>A restore of the etcd keyspace from a backup
might cause issues</strong> due to the disparity between the cluster state and its
metadata in a different point in time. If you need to restore from a backup
after a failure of etcd, contact the StorageOS support team.</p>
<h3 id="quick-install">Quick Install</h3>
<p>For a one command install, the following script uses <code>kubectl</code> to create an
etcd cluster in the <code>storageos-etcd</code> namespace. It requires kubectl in the
system path, and the context set to the appropriate cluster.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -s https://docs.storageos.com/v2.3/sh/deploy-etcd.sh <span style="color:#000;font-weight:bold">|</span> bash
</code></pre></div><h3 id="installation-step-by-step">Installation Step by Step</h3>
<p>For those who would prefer to execute the steps by themselves, they are as
follows:</p>
<ol>
<li>
<p>Configure Namespace</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">export</span> <span style="color:#000">NAMESPACE</span><span style="color:#ce5c00;font-weight:bold">=</span>storageos-etcd
</code></pre></div></li>
<li>
<p>Create Namespace</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create namespace <span style="color:#000">$NAMESPACE</span>
</code></pre></div></li>
<li>
<p>If running in Openshift, an SCC is needed to start Pods</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">oc adm policy add-scc-to-user anyuid system:serviceaccount:<span style="color:#000">$NAMESPACE</span>:default
</code></pre></div></li>
<li>
<p>Create ClusterRole and ClusterRoleBinding</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> $ kubectl -n <span style="color:#000">$NAMESPACE</span> create -f-<span style="color:#4e9a06">&lt;&lt;END
</span><span style="color:#4e9a06"> apiVersion: rbac.authorization.k8s.io/v1beta1
</span><span style="color:#4e9a06"> kind: ClusterRoleBinding
</span><span style="color:#4e9a06"> metadata:
</span><span style="color:#4e9a06">   name: etcd-operator
</span><span style="color:#4e9a06"> roleRef:
</span><span style="color:#4e9a06">   apiGroup: rbac.authorization.k8s.io
</span><span style="color:#4e9a06">   kind: ClusterRole
</span><span style="color:#4e9a06">   name: etcd-operator
</span><span style="color:#4e9a06"> subjects:
</span><span style="color:#4e9a06">   - kind: ServiceAccount
</span><span style="color:#4e9a06">     name: default
</span><span style="color:#4e9a06">     namespace: $NAMESPACE
</span><span style="color:#4e9a06">END</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl -n <span style="color:#000">$NAMESPACE</span> create -f-<span style="color:#4e9a06">&lt;&lt;END
</span><span style="color:#4e9a06">apiVersion: rbac.authorization.k8s.io/v1beta1
</span><span style="color:#4e9a06">kind: ClusterRole
</span><span style="color:#4e9a06">metadata:
</span><span style="color:#4e9a06">  name: etcd-operator
</span><span style="color:#4e9a06">rules:
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - etcd.database.coreos.com
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">  - etcdclusters
</span><span style="color:#4e9a06">  - etcdbackups
</span><span style="color:#4e9a06">  - etcdrestores
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - &#34;*&#34;
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - apiextensions.k8s.io
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">   - customresourcedefinitions
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - &#34;*&#34;
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - &#34;&#34;
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">  - pods
</span><span style="color:#4e9a06">  - services
</span><span style="color:#4e9a06">  - endpoints
</span><span style="color:#4e9a06">  - persistentvolumeclaims
</span><span style="color:#4e9a06">  - events
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - &#34;*&#34;
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - apps
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">  - deployments
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - &#34;*&#34;
</span><span style="color:#4e9a06"># The following permissions can be removed if not using S3 backup and TLS
</span><span style="color:#4e9a06">- apiGroups:
</span><span style="color:#4e9a06">  - &#34;&#34;
</span><span style="color:#4e9a06">  resources:
</span><span style="color:#4e9a06">  - secrets
</span><span style="color:#4e9a06">  verbs:
</span><span style="color:#4e9a06">  - get
</span><span style="color:#4e9a06">END</span>
</code></pre></div></li>
<li>
<p>Deploy Etcd Operator</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl -n <span style="color:#000">$NAMESPACE</span> create -f - <span style="color:#4e9a06">&lt;&lt;END
</span><span style="color:#4e9a06">apiVersion: apps/v1
</span><span style="color:#4e9a06">kind: Deployment
</span><span style="color:#4e9a06">metadata:
</span><span style="color:#4e9a06">  name: etcd-operator
</span><span style="color:#4e9a06">spec:
</span><span style="color:#4e9a06">  selector:
</span><span style="color:#4e9a06">    matchLabels:
</span><span style="color:#4e9a06">      app: etcd-operator
</span><span style="color:#4e9a06">  replicas: 1
</span><span style="color:#4e9a06">  template:
</span><span style="color:#4e9a06">    metadata:
</span><span style="color:#4e9a06">      labels:
</span><span style="color:#4e9a06">        app: etcd-operator
</span><span style="color:#4e9a06">    spec:
</span><span style="color:#4e9a06">      containers:
</span><span style="color:#4e9a06">      - name: etcd-operator
</span><span style="color:#4e9a06">        image: quay.io/coreos/etcd-operator:v0.9.4
</span><span style="color:#4e9a06">        command:
</span><span style="color:#4e9a06">        - etcd-operator
</span><span style="color:#4e9a06">        env:
</span><span style="color:#4e9a06">        - name: MY_POD_NAMESPACE
</span><span style="color:#4e9a06">          valueFrom:
</span><span style="color:#4e9a06">            fieldRef:
</span><span style="color:#4e9a06">              fieldPath: metadata.namespace
</span><span style="color:#4e9a06">        - name: MY_POD_NAME
</span><span style="color:#4e9a06">          valueFrom:
</span><span style="color:#4e9a06">            fieldRef:
</span><span style="color:#4e9a06">              fieldPath: metadata.name
</span><span style="color:#4e9a06">END</span>
</code></pre></div><p>Wait for the Etcd Operator Pod to start</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl -n <span style="color:#000">$NAMESPACE</span> get pod -lapp<span style="color:#ce5c00;font-weight:bold">=</span>etcd-operator
</code></pre></div></li>
<li>
<p>Create the EtcdCluster resource</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">$<span style="color:#f8f8f8;text-decoration:underline"> </span>kubectl<span style="color:#f8f8f8;text-decoration:underline"> </span>-n<span style="color:#f8f8f8;text-decoration:underline"> </span>$NAMESPACE<span style="color:#f8f8f8;text-decoration:underline"> </span>create<span style="color:#f8f8f8;text-decoration:underline"> </span>-f<span style="color:#f8f8f8;text-decoration:underline"> </span>- &lt;&lt;END<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;etcd.database.coreos.com/v1beta2&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;EtcdCluster&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;storageos-etcd&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;3.4.7&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pod</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">etcdEnv</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>ETCD_QUOTA_BACKEND_BYTES<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;2147483648&#34;</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 2 GB</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>ETCD_AUTO_COMPACTION_RETENTION<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1000&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Keep 1000 revisions (default)</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>ETCD_AUTO_COMPACTION_MODE<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;revision&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Set the revision mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">requests</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>200m<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>300Mi<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">securityContext</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">runAsNonRoot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">runAsUser</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">fsGroup</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">tolerations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Exists&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">affinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">podAntiAffinity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">preferredDuringSchedulingIgnoredDuringExecution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">weight</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">podAffinityTerm</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">labelSelector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">              </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>etcd_cluster<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>In<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#f8f8f8;text-decoration:underline">                </span>- storageos-etcd<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">topologyKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>kubernetes.io/hostname<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span>END<span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div></li>
</ol>
<h3 id="installation-verification">Installation Verification</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl -n storageos-etcd get pod,svc
NAME                                 READY   STATUS    RESTARTS   AGE
pod/etcd-operator-55978c4587-8kx7b   1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          2h
pod/storageos-etcd-qm9tmrpnlm        1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          2h
pod/storageos-etcd-rzhjdz74hp        1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          2h
pod/storageos-etcd-wvvv2d9g98        1/1     Running   <span style="color:#0000cf;font-weight:bold">0</span>          2h

NAME                            TYPE        CLUSTER-IP       EXTERNAL-IP PORT<span style="color:#ce5c00;font-weight:bold">(</span>S<span style="color:#ce5c00;font-weight:bold">)</span>             AGE
service/storageos-etcd          ClusterIP   None             &lt;none&gt;      2379/TCP,2380/TCP   22h
service/storageos-etcd-client   ClusterIP   172.30.132.255   &lt;none&gt;      2379/TCP            22h
</code></pre></div><blockquote>
<p>The URL from the Service <code>storageos-etcd-client.storageos-etcd.svc:2379</code>
will be used later in the StorageOS Cluster CustomResource the
<code>kvBackend.address</code>.</p>
</blockquote>
<h2 id="known-etcd-operator-issues">Known etcd-operator issues</h2>
<p>Etcd is a distributed key-value store database focused on strong consistency.
That means that etcd nodes perform operations across the cluster to ensure
quorum. If quorum is lost, etcd nodes stop and etcd marks its contents as
read-only. This is because it cannot guarantee that new data will be valid.
Quorum is fundamental for etcd operations. When running etcd using the CoreOS
Operator, it is important to consider that a loss of quorum could arise from
etcd pods being evicted from nodes.</p>
<p>Operations such as Kubernetes Upgrades with rolling node pools could cause a
total failure of the etcd cluster as nodes are discarded in favor of new ones.</p>
<p>A 3 etcd node cluster can survive losing one node and recover, a 5 node
cluster can survive the loss of two nodes. Loss of further nodes will result in quorum being lost.</p>
<p><strong>The etcd-operator doesn&rsquo;t support a full stop of the cluster. Stopping the
etcd cluster causes the loss of all the etcd keystore and make StorageOS
unable to perform metadata changes.</strong></p>

</div>









<div class="tab-pane fade" id="production" role="tabpanel" aria-labelledby="nav-production">
    <h2 id="production---etcd-on-external-virtual-machines">Production - Etcd on External Virtual Machines</h2>
<p>For production installations, StorageOS strongly recommends running etcd
outside of Kubernetes on a minimum of 3 dedicated virtual machines. This
topology offers strong guarantees of resilience and uptime. We recommend this
architecture in all environments, including those where Kubernetes is being
deployed as a managed service.</p>
<p>StorageOS doesn&rsquo;t require a high performance etcd cluster, as the throughput
of metadata to the cluster is low. However, we recommend a careful assessment
of IOPS capacity <a href="https://docs.storageos.com/v2.3/docs/operations/etcd/#iops-requirements">best practices</a> to ensure that etcd
operates normally.</p>
<p>Depending on the level of redundancy you feel comfortable with you can install
etcd on the Kubernetes Master nodes. <strong>Take extreme care to avoid collisions
of the StorageOS etcd installation with the Kubernetes etcd when using the
Kubernetes Master nodes. Precautions such as changing the default
configuration for the client and peer ports, and ensuring the etcd data
directory is modified. The ansible playbook below will default the etcd
installation directory to <code>/var/lib/storageos-etcd</code>.</strong></p>
<p>You can choose between two installation options.</p>
<ul>
<li><a href="#installation---manual">Manual Installation</a></li>
<li><a href="#installation---ansible">Ansible Installation</a></li>
</ul>
<h3 id="installation---manual">Installation - Manual</h3>
<p>This section documents the steps required for manual installation of etcd
using standard package management commands and systemd manifests.</p>
<blockquote>
<p><strong>Repeat the following steps on all the nodes that will run etcd as a
systemd service.</strong></p>
</blockquote>
<ol>
<li>
<p>Configure Etcd version and ports</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">export</span> <span style="color:#000">ETCD_VERSION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;3.4.9&#34;</span>
<span style="color:#204a87">export</span> <span style="color:#000">CLIENT_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;2379&#34;</span>
<span style="color:#204a87">export</span> <span style="color:#000">PEERS_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;2380&#34;</span>
</code></pre></div><blockquote>
<p><strong>If targeting Kubernetes Master nodes, you must change
<code>CLIENT_PORT</code>, <code>PEERS_PORT</code></strong></p>
</blockquote>
</li>
<li>
<p>Download Etcd from CoreOS official site</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -L https://github.com/coreos/etcd/releases/download/v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>/etcd-v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64.tar.gz -o /tmp/etcd-<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64.tar.gz
mkdir -p /tmp/etcd-v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64
tar -xzvf /tmp/etcd-<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64.tar.gz -C /tmp/etcd-v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64 --strip-components<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
rm /tmp/etcd-<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64.tar.gz
</code></pre></div></li>
<li>
<p>Install Etcd binaries</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">cd</span> /tmp/etcd-v<span style="color:#4e9a06">${</span><span style="color:#000">ETCD_VERSION</span><span style="color:#4e9a06">}</span>-linux-amd64
mv etcd /usr/local/sbin/etcd3
mv etcdctl /usr/local/sbin/etcdctl
chmod <span style="color:#0000cf;font-weight:bold">0755</span> /usr/local/sbin/etcd3 /usr/local/sbin/etcdctl
</code></pre></div></li>
<li>
<p>Set up persistent Etcd data directory</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir /var/lib/storageos-etcd
</code></pre></div></li>
<li>
<p>Create the systemd environment file</p>
<p>On all nodes that will run etcd create a systemd environemnt file
<code>/etc/etcd.conf</code> which has the IPs of all the nodes. The <code>NODE_IP</code> will
need to change to correspond to the node IP where the environment file
resides. <code>NODE1_IP</code>, <code>NODE2_IP</code> and <code>NODE3_IP</code> will remain the same across
all three files.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat <span style="color:#4e9a06">&lt;&lt;END &gt; /etc/etcd.conf
</span><span style="color:#4e9a06"># NODE_IP is the IP of the node where this file resides.
</span><span style="color:#4e9a06">NODE_IP=10.64.10.228
</span><span style="color:#4e9a06"># Node 1 IP
</span><span style="color:#4e9a06">NODE1_IP=10.64.10.228
</span><span style="color:#4e9a06"># Node 2 IP
</span><span style="color:#4e9a06">NODE2_IP=10.64.14.233
</span><span style="color:#4e9a06"># Node 3 IP  
</span><span style="color:#4e9a06">NODE3_IP=10.64.12.111
</span><span style="color:#4e9a06">CLIENT_PORT=${CLIENT_PORT}
</span><span style="color:#4e9a06">PEERS_PORT=${PEERS_PORT}
</span><span style="color:#4e9a06">END</span>

<span style="color:#8f5902;font-style:italic"># Verify that variables are expanded in the file</span>
$ cat /etc/etcd.conf

</code></pre></div></li>
<li>
<p>Create the systemd unit file for etcd3 service</p>
<p>Create a systemd unit file <code>/etc/systemd/system/etcd3.service</code> with the
following information:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">[</span>Unit<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Description</span><span style="color:#ce5c00;font-weight:bold">=</span>etcd3
<span style="color:#000">Documentation</span><span style="color:#ce5c00;font-weight:bold">=</span>https://github.com/coreos/etcd
<span style="color:#000">Conflicts</span><span style="color:#ce5c00;font-weight:bold">=</span>etcd2.service

<span style="color:#ce5c00;font-weight:bold">[</span>Service<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Type</span><span style="color:#ce5c00;font-weight:bold">=</span>notify
<span style="color:#000">Restart</span><span style="color:#ce5c00;font-weight:bold">=</span>always
<span style="color:#000">RestartSec</span><span style="color:#ce5c00;font-weight:bold">=</span>5s
<span style="color:#000">LimitNOFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">40000</span>
<span style="color:#000">TimeoutStartSec</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span>
<span style="color:#000">EnvironmentFile</span><span style="color:#ce5c00;font-weight:bold">=</span>/etc/etcd.conf

<span style="color:#000">ExecStart</span><span style="color:#ce5c00;font-weight:bold">=</span>/usr/local/sbin/etcd3 --name etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --data-dir /var/lib/storageos-etcd <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --quota-backend-bytes <span style="color:#0000cf;font-weight:bold">8589934592</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --auto-compaction-retention <span style="color:#0000cf;font-weight:bold">1000</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --auto-compaction-mode revision <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster-state new <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster-token etcd-token <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --listen-client-urls http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span>,http://127.0.0.1:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --advertise-client-urls http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --listen-peer-urls http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-advertise-peer-urls http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE1_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE1_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>,etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE2_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE2_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>,etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE3_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>http://<span style="color:#4e9a06">${</span><span style="color:#000">NODE3_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>


<span style="color:#ce5c00;font-weight:bold">[</span>Install<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">WantedBy</span><span style="color:#ce5c00;font-weight:bold">=</span>multi-user.target
</code></pre></div><blockquote>
<p><code>$NODE_IP</code> is the IP address of the machine you are installing etcd on.`</p>
</blockquote>
<blockquote>
<p>Note that setting the advertise-client-urls incorrectly will cause any
client connection to fail. StorageOS will fail to communicate to Etcd.</p>
</blockquote>
<blockquote>
<p>If enabling TLS, it is recomended to generate your own CA certificate
and key. You will need to distribute the keys and certificates for the
client auth on all etcd nodes. Moreover, the <code>ExecStart</code> value should
look as below:</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#000">ExecStart</span><span style="color:#ce5c00;font-weight:bold">=</span>/usr/local/sbin/etcd3 --name etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --data-dir /var/lib/storageos-etcd <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --quota-backend-bytes <span style="color:#0000cf;font-weight:bold">8589934592</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --auto-compaction-retention <span style="color:#0000cf;font-weight:bold">1000</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --auto-compaction-mode revision <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --peer-auto-tls <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --client-cert-auth --trusted-ca-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/client-cert.pem <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --cert-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/ca.pem <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --key-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/client-key.pem <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster-state new <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster-token etcd-token <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --listen-client-urls https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --advertise-client-urls https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --listen-peer-urls https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-advertise-peer-urls https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --initial-cluster etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE1_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE1_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>,etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE2_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE2_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>,etcd-<span style="color:#4e9a06">${</span><span style="color:#000">NODE3_IP</span><span style="color:#4e9a06">}</span><span style="color:#ce5c00;font-weight:bold">=</span>https://<span style="color:#4e9a06">${</span><span style="color:#000">NODE3_IP</span><span style="color:#4e9a06">}</span>:<span style="color:#4e9a06">${</span><span style="color:#000">PEERS_PORT</span><span style="color:#4e9a06">}</span>
</code></pre></div></li>
<li>
<p>Reload and start the etc3 systemd service</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ systemctl daemon-reload
$ systemctl <span style="color:#204a87">enable</span> etcd3.service
$ systemctl start  etcd3.service
</code></pre></div></li>
<li>
<p>Installation Verification</p>
<blockquote>
<p>The <code>etcdctl</code> binary is installed at <code>/usr/local/bin</code> on the nodes.</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh <span style="color:#000">$NODE</span> <span style="color:#8f5902;font-style:italic"># Any node running the new etcd</span>
$ <span style="color:#000">ETCDCTL_API</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span> etcdctl --endpoints<span style="color:#ce5c00;font-weight:bold">=</span>http://127.0.0.1:<span style="color:#4e9a06">${</span><span style="color:#000">CLIENT_PORT</span><span style="color:#4e9a06">}</span> member list <span style="color:#8f5902;font-style:italic"># $NODE_IP - the IP of the node</span>
66946cff1224bb5, started, etcd-b94bqkb9rf,  http://172.28.0.1:2380, http://172.28.0.1:2379
17e7256953f9319b, started, etcd-gjr25s4sdr, http://172.28.0.2:2380, http://172.28.0.2:2379
8b698843a4658823, started, etcd-rqdf9thx5p, http://172.28.0.3:2380, http://172.28.0.3:2379
</code></pre></div><blockquote>
<p>Read the <a href="https://docs.storageos.com/v2.3/docs/operations/etcd/">etcd operations</a>
page for our etcd recommendations.</p>
</blockquote>
</li>
</ol>
<h3 id="installation---ansible">Installation - Ansible</h3>
<p>For a repeatable and automated installation, use of a configuration management
tool such as ansible is recommended. StorageOS provides an ansible playbook to
help you deploy etcd on standalone virtual machines.</p>
<ol>
<li>
<p>Clone StorageOS deployment repository</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/storageos/deploy.git
<span style="color:#204a87">cd</span> k8s/deploy-storageos/etcd-helpers/etcd-ansible-systemd
</code></pre></div></li>
<li>
<p>Edit the inventory file</p>
<blockquote>
<p>The inventory file targets the nodes that will run etcd. The file
<code>hosts</code> is an example of such an inventory file.</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat hosts
<span style="color:#ce5c00;font-weight:bold">[</span>nodes<span style="color:#ce5c00;font-weight:bold">]</span>
centos-1 <span style="color:#000">ip</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;10.64.10.228&#34;</span> <span style="color:#000">fqdn</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ip-10-64-10-228.eu-west-2.compute.internal&#34;</span>
centos-2 <span style="color:#000">ip</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;10.64.14.233&#34;</span> <span style="color:#000">fqdn</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ip-10-64-14-233.eu-west-2.compute.internal&#34;</span>
centos-3 <span style="color:#000">ip</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;10.64.12.111&#34;</span> <span style="color:#000">fqdn</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ip-10-64-12-111.eu-west-2.compute.internal&#34;</span>

<span style="color:#8f5902;font-style:italic"># Edit the inventory file</span>
$ vi hosts <span style="color:#8f5902;font-style:italic"># Or your own inventory file</span>
</code></pre></div><blockquote>
<p>The ip or fqdn are used to expose the advertise-client-urls of Etcd.
Failing to provide valid ip/fqdn will cause any client connection to
fail. StorageOS will fail to communicate to Etcd.</p>
</blockquote>
</li>
<li>
<p>Edit the etcd configuration</p>
<blockquote>
<p><strong>If targeting Kubernetes Master nodes, you must change
<code>etcd_port_client</code>, <code>etcd_port_peers</code></strong></p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat group_vars/all
etcd_version: <span style="color:#4e9a06">&#34;3.4.9&#34;</span>
etcd_port_client: <span style="color:#4e9a06">&#34;2379&#34;</span>
etcd_port_peers: <span style="color:#4e9a06">&#34;2380&#34;</span>
etcd_quota_bytes: <span style="color:#0000cf;font-weight:bold">8589934592</span>  <span style="color:#8f5902;font-style:italic"># 8 GB</span>
etcd_auto_compaction_mode: <span style="color:#4e9a06">&#34;revision&#34;</span>
etcd_auto_compaction_retention: <span style="color:#4e9a06">&#34;1000&#34;</span>
members: <span style="color:#4e9a06">&#34;{{ groups[&#39;nodes&#39;] }}&#34;</span>
installation_dir: <span style="color:#4e9a06">&#34;/var/lib/storageos-etcd&#34;</span>
advertise_format: <span style="color:#4e9a06">&#39;fqdn&#39;</span> <span style="color:#8f5902;font-style:italic"># fqdn || ip</span>
backup_file: <span style="color:#4e9a06">&#34;/tmp/backup.db&#34;</span>

tls:
  enabled: <span style="color:#204a87">false</span>
  ca_common_name: <span style="color:#4e9a06">&#34;eu-west-2.compute.internal&#34;</span>
  etcd_common_name: <span style="color:#4e9a06">&#34;*.eu-west-2.compute.internal&#34;</span>
  cert_dir: <span style="color:#4e9a06">&#34;/etc/etcdtls&#34;</span>
  ca_cert_file: <span style="color:#4e9a06">&#34;etcd-ca.pem&#34;</span>
  etcd_server_cert_file: <span style="color:#4e9a06">&#34;server.pem&#34;</span>
  etcd_server_key_file: <span style="color:#4e9a06">&#34;server-key.pem&#34;</span>
  etcd_client_cert_file: <span style="color:#4e9a06">&#34;etcd-client.crt&#34;</span>
  etcd_client_key_file: <span style="color:#4e9a06">&#34;etcd-client.key&#34;</span>

$ vi group_vars/all
</code></pre></div><blockquote>
<p>Choose between using IP addressing or FQDN in the <code>advertise_format</code>
parameter. It allows you to decide how Etcd advertises its address to
clients. This is particularly relevant when using TLS.</p>
</blockquote>
<blockquote>
<p>If enabling TLS, it is recomended to generate your own CA certificate
and key. You can do it by generating the CA from the machine running
Ansible by: <code>ansible-playbook create_ca.yaml</code>.</p>
</blockquote>
</li>
<li>
<p>Install</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible-playbook -i hosts install.yaml
</code></pre></div></li>
<li>
<p>Installation Verification</p>
<blockquote>
<p>The playbook installs the <code>etcdctl</code> binary on the nodes, at
<code>/usr/local/bin</code>.</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh <span style="color:#000">$NODE</span> <span style="color:#8f5902;font-style:italic"># Any node running the new etcd</span>
$ <span style="color:#000">ETCDCTL_API</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span> etcdctl --endpoints<span style="color:#ce5c00;font-weight:bold">=</span>127.0.0.1:2379 member list
66946cff1224bb5, started, etcd-b94bqkb9rf,  http://172.28.0.1:2380, http://172.28.0.1:2379
17e7256953f9319b, started, etcd-gjr25s4sdr, http://172.28.0.2:2380, http://172.28.0.2:2379
8b698843a4658823, started, etcd-rqdf9thx5p, http://172.28.0.3:2380, http://172.28.0.3:2379
</code></pre></div></li>
</ol>
<h2 id="benefits-of-running-external-to-kubernetes">Benefits of Running External to Kubernetes</h2>
<p>Etcd is a distributed key-value store database focused on strong consistency.
That means that etcd nodes perform operations across the cluster to ensure
quorum. In the case that quorum is lost, an etcd node stops and marks its
contents as read-only. Another peer might have a newer version that has not
been committed to the database. Quorum is fundamental for etcd operations.</p>
<p>In a Kubernetes environment, applications are scheduled across and in some
scenarios such as &ldquo;DiskPressure&rdquo; they may need to be evicted from a node, and
be scheduled onto a different node. With an application such as etcd, the
scenario described can result in quorum being lost, making the cluster unable
to recover automatically. Usually a 3 node etcd cluster can survive losing one
node and recover. However, losing a second node at the same time or even
having a network partition between them will result in quorum lost.</p>
<h2 id="bind-etcd-ips-to-kubernetes-service">Bind Etcd IPs to Kubernetes Service</h2>
<p>Kubernetes external services use a DNS name to reference external endpoints,
making them easy to reference from inside the cluster.  You can use the
example from the <a href="https://github.com/storageos/deploy/tree/master/k8s/deploy-storageos/etcd-helpers/etcd-external-svc">helper github
repository</a>
to deploy the external Service. Using an external service can make monitoring
of etcd from Prometheus easier.</p>

</div>





</div>

<h2 id="using-etcd-with-storageos">Using Etcd with StorageOS</h2>
<p>During installation of StorageOS the <code>kvBackend.address</code> parameter of the
StorageOS operator is used to specify the address of the etcd cluster. See the
<a href="https://docs.storageos.com/v2.3/docs/reference/cluster-operator/examples/#installing-with-an-external-etcd">StorageOS cluster operator configuration</a> examples for more information.</p>

	
	
	<div class="text-muted mt-5 pt-3 border-top"></div>
</div>


          </main>
        </div>
      </div>

    </div>
    
<footer class="foot row">
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-2">
      <div class="footer-nav-column">
        <a href="https://storageos.com/" class="custom-logo-link"><img src="https://storageos.com/wp-content/themes/storageOS/images/logo.svg" class="master-logo"></a>
          <div class="footer-social">
              <div class="menu-footer-social-container">
                  <ul id="menu-footer-social" class="menu">
                    <li id="menu-item-22" class="menu-item menu-item-type-custom menu-item-object-custom social-icon twitter menu-item-22"><a href="https://twitter.com/Storage_OS" data-ps2id-api="true"><i class="icon-2x icon-twitter "></i><span class="fa-hidden">Twitter</span></a></li>
                    <li id="menu-item-23" class="menu-item menu-item-type-custom menu-item-object-custom social-icon facebook menu-item-23"><a href="https://www.facebook.com/storageos" data-ps2id-api="true"><i class="icon-2x icon-facebook "></i><span class="fa-hidden">Facebook</span></a></li>
                    <li id="menu-item-24" class="menu-item menu-item-type-custom menu-item-object-custom social-icon linkedin menu-item-24"><a href="https://www.linkedin.com/company/storageos" data-ps2id-api="true"><i class="icon-2x icon-linkedin "></i><span class="fa-hidden">LinkedIn</span></a></li>
                    <li id="menu-item-3202" class="slack menu-item menu-item-type-custom menu-item-object-custom menu-item-3202"><a href="https://slack.storageos.com/" data-ps2id-api="true">Slack</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="footer-nav-wrap footer-nav-wrap-1">
            <div class="col-sm-6">
              <div class="footer-nav-column"><h3 class="widget-title">Product</h3>
                <div class="menu-footer-product-container">
                  <ul id="menu-footer-product" class="menu">
                    <li id="menu-item-3818" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3818"><a href="https://storageos.com/product" data-ps2id-api="true">Overview</a></li>
                    <li id="menu-item-3817" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3817"><a href="https://storageos.com/features" data-ps2id-api="true">Features</a></li>
                    <li id="menu-item-3891" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3891"><a href="https://storageos.com/why-storageos" data-ps2id-api="true">Why StorageOS</a></li>
                    <li id="menu-item-3892" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3892"><a href="https://storageos.com/how-it-works" data-ps2id-api="true">How it works</a></li>
                    <li id="menu-item-3819" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3819"><a href="https://storageos.com/use-cases" data-ps2id-api="true">Use cases</a></li>
                    <li id="menu-item-4616" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4616"><a href="https://storageos.com/support" data-ps2id-api="true">Support</a></li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="col-sm-6">
              <div class="footer-nav-column"><h3 class="widget-title">Solutions</h3>
                <div class="menu-footer-solutions-container">
                  <ul id="menu-footer-solutions" class="menu">
                    <li id="menu-item-3894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3894"><a href="https://storageos.com/developers" data-ps2id-api="true">Developers</a></li>
                    <li id="menu-item-3895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3895"><a href="https://storageos.com/infrastructure-managers" data-ps2id-api="true">Infrastructure Managers</a></li>
                    <li id="menu-item-3893" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3893"><a href="https://storageos.com/cloud" data-ps2id-api="true">Cloud</a></li>
                  </ul>
                </div>

                <h3 class="widget-title">Docs</h3>
                <div class="menu-footer-docs-container">
                  <ul id="menu-footer-docs" class="menu">
                    <li id="menu-item-3828" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3828"><a href="https://docs.storageos.com/" data-ps2id-api="true">Overview</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="footer-nav-wrap footer-nav-wrap-2">
            <div class="col-sm-6">
              <div class="footer-nav-column"><h3 class="widget-title">Company</h3>
                <div class="menu-footer-company-container">
                  <ul id="menu-footer-company" class="menu">
                    <li id="menu-item-3830" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3830"><a href="https://storageos.com/company/#about" data-ps2id-api="true">About Us</a></li>
                    <li id="menu-item-4123" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4123"><a href="https://storageos.com/leadership" data-ps2id-api="true">Leadership</a></li>
                    <li id="menu-item-3840" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3840"><a href="https://storageos.com/careers" data-ps2id-api="true">Careers</a></li>
                    <li id="menu-item-3907" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3907"><a href="https://storageos.com/news" data-ps2id-api="true">News</a></li>
                    <li id="menu-item-3908" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3908"><a href="https://storageos.com/events" data-ps2id-api="true">Events</a></li>
                    <li id="menu-item-4702" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4702"><a href="https://storageos.com/customers" data-ps2id-api="true">Customers</a></li>
                    <li id="menu-item-4617" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4617"><a href="https://storageos.com/partners" data-ps2id-api="true">Partners</a></li>
                    <li id="menu-item-4124" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4124"><a href="https://storageos.com/contact" data-ps2id-api="true">Contact</a></li>
                    <li id="menu-item-3924" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3924"><a href="https://storageos.com/privacy" data-ps2id-api="true">Legal</a></li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="col-sm-6">
              <div class="footer-nav-column"><h3 class="widget-title">Learn</h3>
                <div class="menu-footer-learn-container">
                  <ul id="menu-footer-learn" class="menu">
                    <li id="menu-item-3835" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3835"><a href="https://storageos.com/blog" data-ps2id-api="true">Blog</a></li>
                    <li id="menu-item-3837" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3837"><a href="https://play.storageos.com/" data-ps2id-api="true">play.storageos.com</a></li>
                    <li id="menu-item-3838" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3838"><a href="https://storageos.com/resources" data-ps2id-api="true">Resources</a></li>
                    <li id="menu-item-3839" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3839"><a href="https://resources.storageos.com/demo-request" data-ps2id-api="true">Get a demo</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
</footer>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>









<script src="/v2.3/js/main.min.07381cb6406f1d15281f85a6dea05a3c2e9460f063c7e8dcc39b41f18db3aad0.js" integrity="sha256-BzgctkBvHRUoH4Wm3qBaPC6UYPBjx&#43;jcw5tB8Y2zqtA=" crossorigin="anonymous"></script>


<script type="text/javascript"
	  id="hs-script-loader"
	  async
	  defer
	  src="//js.hs-scripts.com/3402546.js"></script>



  </body>
</html>
